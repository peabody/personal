<html xmlns:tomboy="http://beatniksoftware.com/tomboy" xmlns:link="http://beatniksoftware.com/tomboy/link" xmlns:size="http://beatniksoftware.com/tomboy/size"><head><META http-equiv="Content-Type" content="text/html; charset=utf-8"><title>C571NR Ubuntu Linux Notes</title><style type="text/css">
        
	body {  }
	h1 { font-size: xx-large;
     	     font-weight: bold;
     	     border-bottom: 1px solid black; }
	div.note { overflow: auto;
		   position: relative;
		   display: block;
		   padding: 5pt;
		   margin: 5pt; 
		   white-space: -moz-pre-wrap; /* Mozilla */
 	      	   white-space: -pre-wrap;     /* Opera 4 - 6 */
 	      	   white-space: -o-pre-wrap;   /* Opera 7 */
 	      	   white-space: pre-wrap;      /* CSS3 */
 	      	   word-wrap: break-word;      /* IE 5.5+ */ }
	</style></head><body><div class="note" id="C571NR Ubuntu Linux Notes" style="width:778;"><a name="#C571NR Ubuntu Linux Notes"></a><h1>C571NR Ubuntu Linux Notes</h1>
<b>I just upgraded to Gutsy.  It went very smoothly.  I had to disable Ross Burton's repositories for the upgrade to get on it's way.</b>

I bought a Compaq Presario C571NR laptop and put Ubuntu Linux on it.  Ubuntu Feisty Fawn works like a beauty on this laptop, but the install takes some work.  Hopefully Gutsy fixes a lot of those problems.  I'll update this page when I get the chance.

I'm willing to attempt to answer any questions regarding the laptop and Ubuntu.  Send me an email at skpeterson AT NOSPAM ucdavis DOT edu.  I'm sure you can figure out the address from that.

I've gotten everything on the laptop working that I could care about, however, I must state that I have been unable to test the following:

<ul><li dir="ltr">Modem (I did install the hsf linuxant driver which did seem to install and I now have a <a style="color:#3465A4" href=" /dev/modem"> /dev/modem</a>.  I just don't have a phone line to test on!)
</li><li dir="ltr">S-video out (I'm pretty sure it works)</li></ul>

Outline of the install goes like this:

<ul><li dir="ltr">Install Ubuntu from LiveCD
</li><li dir="ltr">Reboot
</li><li dir="ltr">Plug into wired network and install necessary software for the Broadcom card
</li><li dir="ltr">Configure the Broadcom wireless card
</li><li dir="ltr">Reboot
</li><li dir="ltr">Configure X
</li><li dir="ltr">Reboot
</li><li dir="ltr">Download latest alsa and compile and install
</li><li dir="ltr">Configure Sound
</li><li dir="ltr">Reboot</li></ul>

My checklist of stuff to configure for the post install...
<ul><li dir="ltr">Install gsynaptics to configure touchpad settings
</li><li dir="ltr">Remember to change paper size on printers to US Letter (c'mon can't the install figure this out when we tell it our timezone?).
</li><li dir="ltr">Install openssh-server package for remote login.
</li><li dir="ltr">Setup Ross Burton's repositories of the latest xserver-xorg-video-intel driver with xrandr 1.2 support for hot plugging external monitors
</li><li dir="ltr">Setup firestarter which needs a fix to prevent a conflict with network manager (details here: <a style="color:#3465A4" href="https://help.ubuntu.com/community/Firestarter?highlight=%28firestarter%29">https://help.ubuntu.com/community/Firestarter?highlight=%28firestarter%29</a>).</li></ul>

The first step is to get your wireless card working.  Wireless works once the necessary steps for enabling the Broadcom card were followed on the Ubuntu wiki here (use step 2b): <a style="color:#3465A4" href="https://help.ubuntu.com/community/WifiDocs/Driver/bcm43xx/Feisty_No-Fluff?highlight=%28c571nr%29">https://help.ubuntu.com/community/WifiDocs/Driver/bcm43xx/Feisty_No-Fluff?highlight=%28c571nr%29</a>.  It works well with network manager.  There seems to be  slight issues on waking up from suspend and hibernate every once in a while, but I've found that if you turn off the Ethernet port in the networking control panel, Network Manager will be better behaved regarding the wireless card (this of course makes it so that Network Manager won't manage your Ethernet, which you may or may not need).

X is the next big deal.  To get the most life out of this laptop I recommend running the latest intel driver with the xrandr 1.2 extensions.  The current feisty doesn't come equipped with these features so you can do the following to enable Ross Burton's repository for your apt, and then install the xserver-xorg-video-intel package.  This should be the default in Gutsy so you shouldn't have to do this for that distro.

<span style="font-family:monospace">echo deb <a style="color:#3465A4" href="http://burtonini.com/debian/">http://burtonini.com/debian/</a></span><span style="font-family:monospace"> feisty/|sudo tee -a<a style="color:#3465A4" href=" /etc/apt/sources.list"> /etc/apt/sources.list</a></span><span style="font-family:monospace">
sudo apt-key advanced --keyserver subkeys.pgp.net --recv-keys 0x510E0293</span>

Then put this xorg.conf file in your<a style="color:#3465A4" href=" /etc/X11/"> /etc/X11/</a> folder.  Note that I've disabled the s-video output in the below xorg, because it prevents a blinking problem when opening applications when using the dual-head setup.  If you want S-video, delete any part of the below xorg.conf that has the word "tv" anywhere in it.
<span style="font-family:monospace">
#<a style="color:#3465A4" href=" /etc/X11/xorg.conf"> /etc/X11/xorg.conf</a></span><span style="font-family:monospace"> (xorg X Window System server configuration file)
#
# This file was generated by dexconf, the Debian X Configuration tool, using
# values from the debconf database.
#
# Edit this file with caution, and see the xorg.conf(5) manual page.
# (Type "man xorg.conf" at the shell prompt.)
#
# This file is automatically updated on xserver-xorg package upgrades *only*
# if it has not been modified since the last upgrade of the xserver-xorg
# package.
#
# If you have edited this file but would like it to be automatically updated
# again, run the following command:
#   sudo dpkg-reconfigure -phigh xserver-xorg

Section "Files"
	FontPath	"/usr/share/fonts/X11/misc"
	FontPath	"/usr/share/fonts/X11/cyrillic"
	FontPath	"/usr/share/fonts/X11/100dpi/:unscaled"
	FontPath	"/usr/share/fonts/X11/75dpi/:unscaled"
	FontPath	"/usr/share/fonts/X11/Type1"
	FontPath	"/usr/share/fonts/X11/100dpi"
	FontPath	"/usr/share/fonts/X11/75dpi"
	# path to defoma fonts
	FontPath	"/var/lib/defoma/x-ttcidfont-conf.d/dirs/TrueType"
EndSection

Section "Module"
	Load	"i2c"
	Load	"bitmap"
	Load	"ddc"
	Load	"dri"
	Load	"extmod"
	Load	"freetype"
	Load	"glx"
	Load	"int10"
	Load	"vbe"
EndSection

Section "InputDevice"
	Identifier	"Generic Keyboard"
	Driver		"kbd"
	Option		"CoreKeyboard"
	Option		"XkbRules"	"xorg"
	Option		"XkbModel"	"pc104"
	Option		"XkbLayout"	"us"
	Option		"XkbVariant"	"dvorak"
EndSection

Section "InputDevice"
	Identifier	"Configured Mouse"
	Driver		"mouse"
	Option		"CorePointer"
	Option		"Device"		"/dev/input/mice"
	Option		"Protocol"		"ImPS/2"
	Option		"ZAxisMapping"		"4 5"
	Option		"Emulate3Buttons"	"true"
EndSection

Section "InputDevice"
	Identifier	"Synaptics Touchpad"
	Driver		"synaptics"
	Option		"SendCoreEvents"	"true"
	Option		"Device"		"/dev/psaux"
	Option		"Protocol"		"auto-dev"
	Option		"HorizScrollDelta"	"0"
	Option		"SHMConfig"
EndSection

Section "InputDevice"
	Driver		"wacom"
	Identifier	"stylus"
	Option		"Device"	"/dev/input/wacom"
	Option		"Type"		"stylus"
	Option		"ForceDevice"	"ISDV4"		# Tablet PC ONLY
EndSection

Section "InputDevice"
	Driver		"wacom"
	Identifier	"eraser"
	Option		"Device"	"/dev/input/wacom"
	Option		"Type"		"eraser"
	Option		"ForceDevice"	"ISDV4"		# Tablet PC ONLY
EndSection

Section "InputDevice"
	Driver		"wacom"
	Identifier	"cursor"
	Option		"Device"	"/dev/input/wacom"
	Option		"Type"		"cursor"
	Option		"ForceDevice"	"ISDV4"		# Tablet PC ONLY
EndSection

Section "Device"
	Identifier	"Intel Corporation Mobile 945GM/GMS/940GML Express Integrated Graphics Controller"
	Driver		"intel"
	Option "monitor-TV"	"TV"
EndSection

Section "Monitor"
	Identifier	"Generic Monitor"
	Option		"DPMS"
EndSection

Section "Monitor"
	Identifier "TV"
	Option	"Ignore" "True"
EndSection

Section "Screen"
	Identifier	"Default Screen"
	Device		"Intel Corporation Mobile 945GM/GMS/940GML Express Integrated Graphics Controller"
	Monitor		"Generic Monitor"
	DefaultDepth	24
	SubSection "Display"
		Depth		1
		Modes		"1280x800"
	EndSubSection
	SubSection "Display"
		Depth		4
		Modes		"1280x800"
	EndSubSection
	SubSection "Display"
		Depth		8
		Modes		"1280x800"
	EndSubSection
	SubSection "Display"
		Depth		15
		Modes		"1280x800"
	EndSubSection
	SubSection "Display"
		Depth		16
		Modes		"1280x800"
	EndSubSection
	SubSection "Display"
		Depth		24
		Viewport	0 0
		Virtual		2048 2048
		Modes		"1280x800" "1280x768" "1024x768" "800x600" "640x480"
	EndSubSection
EndSection

Section "ServerLayout"
	Identifier	"Default Layout"
	Screen		"Default Screen"
	InputDevice	"Generic Keyboard"
	InputDevice	"Configured Mouse"
	InputDevice     "stylus"	"SendCoreEvents"
	InputDevice     "cursor"	"SendCoreEvents"
	InputDevice     "eraser"	"SendCoreEvents"
	InputDevice	"Synaptics Touchpad"
EndSection

Section "DRI"
	Mode	0666
EndSection</span>

Reboot.  Now...to hot plug an external display, plug your external monitor into the vga port once you've logged in and then run the following:

xrandr --output VGA --mode 1280x1024 --above LVDS

You can change the mode to whatever your external can handle.  However, something to be concerned with is that the intel graphics adapter can't handle a combined resolution greater than 2048 in either direction and run DRI at the same time, so you'll have to experiment.

Sound:
The soundcard in the laptop is an onboard intel using a Conexant chipset (named 5045 or CX2059 Venice).  I experienced the most issues here (felt like it anyway, even though everything works perfectly now).  Sound worked from a fresh install (after updates and reboot applied), but there were two big issues: 1) speakers didn't mute upon plugging in headphones, and the mic seemed to have issues.  It took me a while to fix.  I followed the instructions on this page: <a style="color:#3465A4" href="https://help.ubuntu.com/community/HdaIntelSoundHowto">https://help.ubuntu.com/community/HdaIntelSoundHowto</a>.  The key seemed to be setting my module options for snd-hda-intel to "model=laptop position_fix=1" (put a line at the end of the<a style="color:#3465A4" href=" /etc/modprobe.d/alsa-base"> /etc/modprobe.d/alsa-base</a> file).  That solved both problems for the most part.  Volume level is a little low.  Full-cranked volume is pretty loud, but it tapers off quick.  Half volume is almost inaudible.

I had to go into the Volume Control and pretty much enable everything to get my mic recording.  Recording seems to have various quirks across different programs.  recordmydesktop required the "position_fix" part on my module parameters.  Skype version 1.4.0.99 (downloaded directly from Skype's website) seems to work perfectly.  Audacity seems to have issues changing the sample rate of the input.  Setting the sample rate to 48000 and sample format to 16-bit, then closing and reopening Audacity and using the alsa analog input seemed to fix this.  Wine didn't work with my OSS drivers, but it worked perfectly with the alsa drivers (even including Half Life 2!).

Note: Do not use alsa later than 1.0.14.  I tried the very latest 1.0.15rc2 (just to be safe) but it seemed to have multiple issues including lots of "popping" and feedback.

Note: kernel updates overwrite the new alsa-driver install, so that will have to be reinstalled after every kernel update.  Note that gutsy uses this version of alsa, so I'm pretty sure you won't have to worry about installing your own alsa and keeping it up.

Issues I'm still resolving:
Suspend seems to fail or crash every once in a while.  Hibernate seems more stable.</div></body></html>